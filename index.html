<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Christmas Tree Vision</title>

    <!-- 字体引入 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />

    <!-- Import Map -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
          "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/+esm"
        }
      }
    </script>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loader">
      <div class="spinner"></div>
      <div class="loader-text">LOADING HOLIDAY MAGIC</div>
    </div>

    <!-- UI Overlay -->
    <div id="ui-layer">
      <h1>Merry Christmas</h1>

      <button id="help-button" class="btn-gold">Help</button>
      <div id="help-modal">
        <div class="help-content">
          <div class="help-header">
            <h2>使用说明</h2>
            <button class="help-close btn-gold">Close</button>
          </div>
          <ul id="help-list"></ul>
        </div>
      </div>

      <script>
        (() => {
          const isZh =
            /^zh/i.test(navigator.language || navigator.userLanguage || "") ||
            (navigator.languages || []).some((l) => /^zh/i.test(l));
          const t = isZh
            ? {
                btn: "Help",
                title: "使用说明",
                items: [
                  "允许摄像头：启用手势魔法与模式切换。",
                  "聚合状态下双击屏幕/张开手手掌：散开漂浮。",
                  "漂浮状态下单击/捏合手指：随机聚焦一张照片。",
                  "聚焦状态下单击/发送手指：回到漂浮状态。",
                  "漂浮状态下鼠标双击/握拳：重组成圣诞树。",
                  "拖拽/触控水平旋转视角",
                  "点击 'Add Memories' 上传图片作为装饰。",
                ],
              }
            : {
                btn: "Help",
                title: "How to Play",
                items: [
                  "Allow Camera: Enable Gesture Magic and Mode Switching.",
                  "Double-tap or Open Palm (MODE-TREE): Scatter and float.",
                  "Click / Pinch (MODE-SCATTER): Focus on a random photo.",
                  "Click / Release (MODE-FOCUS): Return to floating state.",
                  "Double-click / Make a Fist (MODE-SCATTER): Reassemble into a Christmas tree.",
                  "Drag / Touch to rotate the view horizontally.",
                  "Click 'Add Memories' to upload your photos as decorations.",
                ],
              };
          const btn = document.getElementById("help-button");
          if (btn) btn.textContent = t.btn;
          const title = document.querySelector("#help-modal h2");
          if (title) title.textContent = t.title;
          const list = document.getElementById("help-list");
          if (list) {
            list.innerHTML = "";
            t.items.forEach((txt) => {
              const li = document.createElement("li");
              li.textContent = txt;
              list.appendChild(li);
            });
          }
        })();
      </script>

      <div class="upload-wrapper">
        <input type="file" id="file-input" accept="image/*" />
        <button
          class="btn-gold"
          onclick="document.getElementById('file-input').click()"
        >
          Add Memories
        </button>
        <span class="hint-text">Press 'H' to Hide Controls</span>
      </div>
    </div>

    <!-- 3D Container -->
    <div id="canvas-container"></div>

    <!-- Hidden CV Elements -->
    <div class="vision-debug">
      <video
        id="webcam"
        style="width: 160px; height: 120px"
        autoplay
        playsinline
      ></video>
      <canvas id="vision_canvas" width="160" height="120"></canvas>
    </div>

    <!-- Logic -->
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
